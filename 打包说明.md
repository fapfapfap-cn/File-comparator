# 文件比较器打包说明

## 概述
本文档说明如何将Python文件比较器应用程序打包成可执行文件。

## 环境要求
- Python 3.7+
- PyInstaller
- 项目依赖：PySimpleGUI, openpyxl

## 安装依赖

### 1. 激活虚拟环境
```bash
# Windows
venv\Scripts\activate

# macOS/Linux
source venv/bin/activate
```

### 2. 安装PyInstaller
```bash
pip install pyinstaller
```

## 打包方法

### 方法一：使用打包脚本（推荐）

项目中提供了自动化打包脚本 `build_exe.py`，支持跨平台自动适配：

```bash
# 运行打包脚本
python build_exe.py

# 选择操作：
# 1. 直接打包
# 2. 创建规格文件
```

#### 平台特定行为
- **Windows**: 使用 `--onefile` 模式，生成单个 .exe 文件
- **macOS**: 使用 `--onedir` 模式，生成 .app 应用程序包
- **Linux**: 使用 `--onefile` 模式，生成单个可执行文件

### 方法二：直接使用PyInstaller命令

#### Windows 64位打包
```bash
pyinstaller --onefile --noconsole --name="文件比较器" --hidden-import=openpyxl --hidden-import=PySimpleGUI main.py
```

#### macOS 打包
```bash
pyinstaller --onefile --windowed --name="文件比较器" --hidden-import=openpyxl --hidden-import=PySimpleGUI main.py
```

#### Linux 打包
```bash
pyinstaller --onefile --name="文件比较器" --hidden-import=openpyxl --hidden-import=PySimpleGUI main.py
```

## PyInstaller 参数说明

| 参数 | 说明 |
|------|------|
| `--onefile` | 打包成单个可执行文件 |
| `--noconsole` | Windows下不显示控制台窗口 |
| `--windowed` | macOS下创建.app包 |
| `--name` | 指定可执行文件名称 |
| `--icon` | 指定图标文件 |
| `--hidden-import` | 手动指定需要包含的模块 |
| `--add-data` | 包含额外的数据文件 |

## 跨平台打包注意事项

### Windows
- 生成的exe文件位于 `dist/` 目录
- 文件大小通常在 20-50MB
- 支持64位系统
- 可以添加图标文件（.ico格式）

### macOS
- 生成的.app包位于 `dist/` 目录
- 需要在macOS系统上进行打包
- 支持Apple Silicon (M1/M2) 和 Intel 处理器

### Linux
- 生成的可执行文件位于 `dist/` 目录
- 需要在对应的Linux发行版上打包
- 支持64位系统

## 优化建议

### 1. 减小文件大小
```bash
# 使用UPX压缩（需要先安装UPX）
pyinstaller --onefile --upx-dir=/path/to/upx main.py

# 排除不需要的模块
pyinstaller --onefile --exclude-module=matplotlib main.py
```

### 2. 添加图标
1. 准备图标文件（Windows: .ico, macOS: .icns）
2. 使用 `--icon=icon.ico` 参数

### 3. 包含额外文件
```bash
# 包含README文件
pyinstaller --onefile --add-data="README.md;." main.py
```

## 常见问题解决

### 1. 模块导入错误
**问题**: 运行时提示找不到某个模块
**解决**: 使用 `--hidden-import=模块名` 参数

### 2. 文件过大
**问题**: 生成的exe文件太大
**解决**: 
- 使用虚拟环境，只安装必要的包
- 使用 `--exclude-module` 排除不需要的模块
- 使用UPX压缩

### 3. 启动慢
**问题**: 程序启动时间长
**解决**: 
- 使用 `--onedir` 模式而不是 `--onefile`
- 优化代码，减少启动时的导入

### 4. 权限问题（Windows）
**问题**: 杀毒软件误报或权限不足
**解决**: 
- 将exe文件添加到杀毒软件白名单
- 使用代码签名证书

## 测试打包结果

1. 在目标系统上运行生成的可执行文件
2. 测试所有功能是否正常
3. 检查文件选择、Excel导出等功能
4. 验证错误处理是否正常

## 分发建议

1. **Windows**: 可以直接分发exe文件，或创建安装包
2. **macOS**: 分发.app包，可能需要代码签名
3. **Linux**: 分发可执行文件，可能需要提供依赖说明

## 自动化打包

可以创建批处理脚本或shell脚本来自动化打包过程：

### Windows批处理 (build.bat)
```batch
@echo off
echo 开始打包文件比较器...
call venv\Scripts\activate
pyinstaller --onefile --noconsole --name="文件比较器" main.py
echo 打包完成！
pause
```

### macOS/Linux脚本 (build.sh)
```bash
#!/bin/bash
echo "开始打包文件比较器..."
source venv/bin/activate
pyinstaller --onefile --windowed --name="文件比较器" main.py
echo "打包完成！"
```

---

**注意**: 打包后的可执行文件只能在对应的操作系统上运行。如需支持多个平台，需要在各自的系统上分别进行打包。